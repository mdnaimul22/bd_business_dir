{% extends 'base.html' %}

{% block title %}{{ shop.name }} - ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶á‡¶û‡ßç‡¶ú‡¶ø‡¶®‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï‡¶∂‡¶™{% endblock %}

{% block content %}
<section class="shop-detail">
    <div class="shop-detail-header"
        style="display: flex; justify-content: space-between; align-items: stretch; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.5rem;">
        <!-- Left Box: Category & Shop Name & Proprietor (Card Style) -->
        <div class="detail-card"
            style="flex: 1; min-width: 280px; display: flex; flex-direction: column; justify-content: flex-start; padding: 0.75rem 1rem;">
            <!-- Top Row: Label (left) + Category (right) -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                <h3 style="margin: 0; font-size: 16px; color: #666;">üè™ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®</h3>
                {% if shop.category_name %}
                <a href="{{ url_for('category_shops', category_id=shop.category_id) }}" class="category-badge large">
                    {{ shop.category_name }}
                </a>
                {% endif %}
            </div>
            <!-- Shop Name -->
            <h1 style="margin: 0 0 1rem 0; font-size: 2.0rem;">{{ shop.name }}</h1>
            <!-- Proprietor -->
            <div style="font-size: 1rem; color: #555;">
                <span style="color: #888;">üë§ ‡¶Æ‡¶æ‡¶≤‡¶ø‡¶ï:</span> {{ shop.proprietor or '‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º ‡¶®‡¶æ‡¶á' }}
            </div>
        </div>

        <!-- Right Box: Visiting Card (Card Style, 89mm x 51mm aspect ratio) -->
        <div class="detail-card"
            style="flex-shrink: 0; min-width: 280px; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding: 0.5rem 1rem;">
            <h3 style="margin: 0 0 0.5rem 0; font-size: 14px; color: #666;">‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü‡¶ø‡¶Ç ‡¶ï‡¶æ‡¶∞‡ßç‡¶°</h3>
            {% if shop.visiting_card %}
            <img src="/shop_img/{{ shop.visiting_card }}" alt="Visiting Card for {{ shop.name }}"
                style="width: 267px; height: 153px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #e0e0e0;">
            {% else %}
            <div
                style="width: 267px; height: 153px; background: #f5f5f5; border-radius: 6px; border: 2px dashed #ddd; display: flex; align-items: center; justify-content: center; color: #999;">
                ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡ßá‡¶á
            </div>
            {% endif %}
        </div>
    </div>

    <div class="shop-detail-body">
        <div class="detail-grid">

            <!-- Products Card (First) -->
            <div class="detail-card">
                <h3>üì¶ {{ _('Products List') }}</h3>
                <div class="products-content">
                    {{ shop.products or _('No products list available') }}
                </div>
            </div>

            <!-- Contact Info Card (Second - moved from third position) -->
            <div class="detail-card">
                <h3>üìû ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó</h3>

                <div class="detail-row">
                    <div class="detail-label">üìç ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ:</div>
                    <div class="detail-value">{{ shop.address or '-' }}</div>
                </div>

                <div class="detail-row">
                    <div class="detail-label">üì± ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤:</div>
                    <div class="detail-value">
                        {% if shop.mobile %}
                        {% for num in shop.mobile.split() %}
                        <a href="tel:{{ num }}" class="phone-link">{{ num }}</a>
                        {% endfor %}
                        {% else %}
                        -
                        {% endif %}
                    </div>
                </div>

                <div class="detail-row">
                    <div class="detail-label">üí∞ {{ _('Online Transaction') }}:</div>
                    <div class="detail-value">{{ shop.transaction_status or '-' }}</div>
                </div>

                <div class="detail-row">
                    <div class="detail-label">üí¨ ‡¶π‡ßã‡¶Ø‡¶º‡¶æ‡¶ü‡¶∏‡¶è‡¶™:</div>
                    <div class="detail-value">
                        {% if shop.whatsapp %}
                        <a href="https://wa.me/{{ shop.whatsapp.replace('-', '').replace(' ', '') }}" target="_blank"
                            class="whatsapp-link">
                            {{ shop.whatsapp }}
                        </a>
                        {% else %}
                        -
                        {% endif %}
                    </div>
                </div>

                <div class="detail-row">
                    <div class="detail-label">üìß {{ _('Email/Web') }}:</div>
                    <div class="detail-value">
                        {% set contact = shop.email_web | parse_contact_info %}
                        {% if contact.type == 'email' %}
                        <a href="mailto:{{ contact.value }}" class="email-link">{{ contact.value }}</a>
                        {% elif contact.type == 'web' %}
                        <a href="{{ contact.value if 'http' in contact.value else 'http://' + contact.value }}"
                            target="_blank" class="web-link">{{ contact.value }}</a>
                        {% else %}
                        {{ contact.value }}
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Google Map Placeholder (Third - where Contact was) -->
            <div class="detail-card">
                <h3>üó∫Ô∏è ‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™</h3>
                <div
                    style="width: 100%; height: 200px; background: #f0f0f0; border-radius: 8px; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; color: #888; font-size: 1rem;">
                    ‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶á‡¶®‡ßç‡¶ü‡¶ø‡¶ó‡ßç‡¶∞‡ßá‡¶∂‡¶® (‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ü‡¶∏‡¶õ‡ßá)
                </div>
            </div>

        </div>
    </div>

    <div class="shop-detail-actions">
        <a href="{{ url_for('edit_shop', shop_id=shop.id) }}" class="btn btn-primary">‚úèÔ∏è {{ _('Edit') }}</a>
        <form action="{{ url_for('delete_shop', shop_id=shop.id) }}" method="POST" class="delete-form"
            onsubmit="return checkDeletePassword();">
            <input type="hidden" name="delete_password" id="delete_password_field">
            <button type="submit" class="btn btn-danger">üóëÔ∏è {{ _('Delete') }}</button>
        </form>
        <a href="{{ url_for('index') }}" class="btn btn-secondary">‚Üê {{ _('Back') }}</a>
    </div>

    <script>
        function checkDeletePassword() {
            var password = prompt("‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®:");
            if (password === null) {
                return false; // User cancelled
            }
            document.getElementById('delete_password_field').value = password;
            return true;
        }
    </script>
</section>
{% endblock %}